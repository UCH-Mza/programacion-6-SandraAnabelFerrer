@page "/procesos"

<h1>Procesos en Paralelo</h1>

@foreach (var proceso in procesos)
{
    <div>
        <h3>Proceso @proceso.Id</h3>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: @proceso.Porcentaje%" aria-valuenow="@proceso.Porcentaje" aria-valuemin="0" aria-valuemax="100">@proceso.Porcentaje%</div>
        </div>
    </div>
}

@code {
    List<Proceso> procesos = new List<Proceso>();

    protected override async Task OnInitializedAsync()
    {
        await EjecutarProcesosAsync();
    }

    async Task EjecutarProcesosAsync()
    {
        var tasks = new List<Task>();
        var random = new Random();

        for (int i = 1; i <= 6; i++)
        {
            var proceso = new Proceso { Id = i, Porcentaje = 0 };
            procesos.Add(proceso);

            var progress = new Progress<int>(porcentaje =>
            {
                proceso.Porcentaje = porcentaje;
                StateHasChanged(); // Actualizar la interfaz de usuario
            });

            tasks.Add(EjecutarProcesoAsync(random.Next(50, 100), progress));
        }

        await Task.WhenAll(tasks);
    }

    async Task EjecutarProcesoAsync(int limiteAleatorio, IProgress<int> progress)
    {
        for (int i = 0; i <= limiteAleatorio; i++)
        {
            await Task.Delay(1000); // Simula un trabajo
            progress.Report(i * 100 / limiteAleatorio);
        }
    }

    class Proceso
    {
        public int Id { get; set; }
        public int Porcentaje { get; set; }
    }
}
